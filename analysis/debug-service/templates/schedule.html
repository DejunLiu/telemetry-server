{% import 'macros.html' as macros with context %}
{% extends "base.html" %}
{% block title %}
 <img width="48" src="{{ url_for('static', filename='schedule.png') }}" />
 Schedule an analysis job
{% endblock %}
{% block content %}
 <div class="blurb">
 Run a telemetry analysis on a scheduled basis. The output of the analysis will be publicly available.
 </div>
 {% if jobs %}
  <div class="jobs">
   <ul>
    {% for job in jobs %}
     <li>{{ job.id }} {{ job.name }}</li>
    {% endfor %}
   </ul>
  </div>
 {% endif %}

 <form action="{{ url_for('create_scheduled_job') }}" method="post" enctype="multipart/form-data">
  <hr/>
  <table>

   {% call macros.make_input('job-name', 'Job Name') %}
    The job name will form part of the location of the code tarball below, as
    well as part of the path to the public data in S3
   {% endcall %}

   {% call macros.make_input('code-tarball', 'Code Tarball', type='file') %}
    This <code>.tar.gz</code> file should contain all the code needed to run
    your job. Recommended form: <code>job-name-0.1.tar.gz</code>
   {% endcall %}

   {% call macros.make_input('commandline', 'Execution Commandline', value='./run.sh') %}
    The tarball will be unpacked on a worker node, then this command will be
    invoked from the same directory
   {% endcall %}

   {% call macros.make_input('output-dir', 'Output Directory', value='output') %}
    After running the above command, any files found in this dir (relative to
    the root where the tarball is unpacked) will be made publicly available in
    Amazon S3.  Any files that are already in S3 at the above location will be
    overwritten by new files of the same name.
   {% endcall %}

   {{ macros.begin_select(errors, 'schedule-frequency', 'Schedule Frequency') }}
   {{ macros.select_option('daily',   'Daily') }}
   {{ macros.select_option('weekly',  'Weekly') }}
   {{ macros.select_option('monthly', 'Monthly') }}
   {{ macros.end_select_options() }}
    The job will be run periodically per this selection
   {{ macros.end_select() }}

   {{ macros.begin_select(errors, 'schedule-day-of-week', 'Day of Week') }}
    {{ macros.select_option('0', 'Sunday') }}
    {{ macros.select_option('1', 'Monday') }}
    {{ macros.select_option('2', 'Tuesday') }}
    {{ macros.select_option('3', 'Wednesday') }}
    {{ macros.select_option('4', 'Thursday') }}
    {{ macros.select_option('5', 'Friday') }}
    {{ macros.select_option('6', 'Saturday') }}
   {{ macros.end_select_options() }}
    The job will run weekly on this day
   {{ macros.end_select() }}

   {% call macros.make_input('schedule-day-of-month', 'Day of Month', value='1') %}
    The job will run monthly on this day
   {% endcall %}

   {{ macros.begin_select(errors, 'schedule-time-of-day', 'Time of Day (UTC)') }}
    {{ macros.select_option('0', 'Midnight') }}
    {{ macros.select_option('1', '1am') }}
    {{ macros.select_option('2', '2am') }}
    {{ macros.select_option('3', '3am') }}
    {{ macros.select_option('4', '4am') }}
    {{ macros.select_option('5', '5am') }}
    {{ macros.select_option('6', '6am') }}
    {{ macros.select_option('7', '7am') }}
    {{ macros.select_option('8', '8am') }}
    {{ macros.select_option('9', '9am') }}
    {{ macros.select_option('10', '10am') }}
    {{ macros.select_option('11', '11am') }}
    {{ macros.select_option('12', 'Noon', True) }}
    {{ macros.select_option('13', '1pm') }}
    {{ macros.select_option('14', '2pm') }}
    {{ macros.select_option('15', '3pm') }}
    {{ macros.select_option('16', '4pm') }}
    {{ macros.select_option('17', '5pm') }}
    {{ macros.select_option('18', '6pm') }}
    {{ macros.select_option('19', '7pm') }}
    {{ macros.select_option('20', '8pm') }}
    {{ macros.select_option('21', '9pm') }}
    {{ macros.select_option('22', '10pm') }}
    {{ macros.select_option('23', '11pm') }}
   {{ macros.end_select_options() }}
    The job will be run at this time.  Note: if you want to process the
    previous day's data, it's good to leave a few hours' buffer for the data
    to be published, so start those types of jobs later in the day.
   {{ macros.end_select() }}

   {% call macros.make_input('timeout', 'Job Timeout (minutes)', value='120') %}
    If the job does not complete within this many minutes, it will
    automatically be killed.
   {% endcall %}
  </table>
  <hr/>
  <input type="submit" name="submit" value="Submit">
 </form>
{% endblock %}

{% block footer %}
 <a href="{{ url_for('index') }}">Home</a> <br/>
 <a href="{{ url_for('get_worker_params') }}">Launch an ad-hoc analysis worker</a>
{% endblock %}
